(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["zm-sign"]=e():t["zm-sign"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s="fb15")}({3430:function(t,e,n){},8875:function(t,e,n){var i,r,o;(function(n,s){r=[],i=s,o="function"===typeof i?i.apply(e,r):i,void 0===o||(t.exports=o)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(f){var n,i,r,o=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,s=/@([^@]*):(\d+):(\d+)\s*$/gi,a=o.exec(f.stack)||s.exec(f.stack),c=a&&a[1]||!1,l=a&&a[2]||!1,u=document.location.href.replace(document.location.hash,""),d=document.getElementsByTagName("script");c===u&&(n=document.documentElement.outerHTML,i=new RegExp("(?:[^\\n]+?\\n){0,"+(l-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),r=n.replace(i,"$1").trim());for(var h=0;h<d.length;h++){if("interactive"===d[h].readyState)return d[h];if(d[h].src===c)return d[h];if(c===u&&d[h].innerHTML&&d[h].innerHTML.trim()===r)return d[h]}return null}}return t}))},9224:function(t){t.exports=JSON.parse('{"name":"zm-sign","version":"1.0.2","author":"zzh","private":false,"main":"lib/zm-sign.common.js","homepage":"https://gitee.com/sangtian152/zm-sign","files":["lib"],"repository":{"type":"git","url":"https://gitee.com/sangtian152/zm-sign.git"},"keywords":["canvas","vue","components"],"scripts":{"serve":"vue-cli-service serve","build":"vue-cli-service build","lint":"vue-cli-service lint --fix","build-lib":"vue-cli-service build --target lib --name zm-sign --dest lib src/index.js"},"dependencies":{"core-js":"^3.6.5","style-loader":"^2.0.0","vue":"^2.6.11"},"devDependencies":{"@vue/cli-plugin-babel":"~4.5.0","@vue/cli-plugin-eslint":"~4.5.0","@vue/cli-plugin-router":"~4.5.0","@vue/cli-plugin-vuex":"~4.5.0","@vue/cli-service":"~4.5.0","@vue/eslint-config-prettier":"^6.0.0","babel-eslint":"^10.1.0","eslint":"^6.7.2","eslint-plugin-prettier":"^3.1.3","eslint-plugin-vue":"^6.2.2","iview-loader":"^1.3.0","markdown-it":"^12.0.2","markdown-it-anchor":"^6.0.0","markdown-it-chain":"^1.3.0","markdown-it-container":"^3.0.0","node-sass":"^4.12.0","prettier":"^1.19.1","sass-loader":"^10.0.4","transliteration":"^2.1.11","view-design":"^4.4.0","vue-router":"^3.2.0","vue-template-compiler":"^2.6.11"}}')},b20f:function(t,e,n){},b841:function(t,e){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(t,e){"use strict";if(void 0===t||null===t)throw console.log(e),new TypeError("Cannot convert first argument to object");for(var n=Object(t),i=1;i<arguments.length;i++){var r=arguments[i];if(void 0!==r&&null!==r)for(var o=Object.keys(Object(r)),s=0,a=o.length;s<a;s++){var c=o[s],l=Object.getOwnPropertyDescriptor(r,c);void 0!==l&&l.enumerable&&(n[c]=r[c])}}return n}}),Array.isArray||Object.defineProperty(Array,"isArray",{enumerable:!1,configurable:!0,writable:!0,value:function(t){return"[object Array]"==Object.prototype.toString.call(t)}})},f6d3:function(t,e,n){"use strict";n("3430")},fb15:function(t,e,n){"use strict";if(n.r(e),"undefined"!==typeof window){var i=window.document.currentScript,r=n("8875");i=r(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:r});var o=i&&i.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);o&&(n.p=o[1])}n("b841");var s=n("9224");const a={};function c(t="default"){let e="";switch(t){case"primary":e="#2d8cf0";break;case"success":e="#19be6b";break;case"info":e="#909399";break;case"warning":e="#ff9900";break;case"danger":e="#ff4d4f";break;case"default":e="#35495E";break;default:e=t;break}return e}a.print=function(t,e="default",n=!1){"object"!==typeof t?n?console.log(`%c ${t} `,`background:${c(e)}; padding: 2px; border-radius: 4px;color: #fff;`):console.log(`%c ${t} `,`color: ${c(e)};`):console.dir(t)},a.pretty=function(t,e,n="primary"){console.log(`%c ${t} %c ${e} %c`,`background:${c(n)};border:1px solid ${c(n)}; padding: 1px; border-radius: 4px 0 0 4px; color: #fff;`,`border:1px solid ${c(n)}; padding: 1px; border-radius: 0 4px 4px 0; color: ${c(n)};`,"background:transparent")},a.primary=function(t,e=!1){this.print(t,"primary",e)},a.success=function(t,e=!1){this.print(t,"success",e)},a.info=function(t,e=!1){this.print(t,"info",e)},a.warning=function(t,e=!1){this.print(t,"warning",e)},a.danger=function(t,e=!1){this.print(t,"danger",e)};var l=a,u={async install(t){t.config.productionTip=!1,t.prototype.$log=l,l.pretty("["+s.name+"] "+s.version,"success")}},d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"canvasHW",staticClass:"zm-sign"},[n("div",{staticClass:"can_vans"},[n("canvas",{ref:"canvasF",attrs:{width:t.canvasWidth?t.canvasWidth:t.w,height:t.canvasHeight?t.canvasHeight:t.h},on:{touchstart:t.touchStart,touchmove:t.touchMove,touchend:t.touchEnd,mousedown:t.mouseDown,mousemove:t.mouseMove,mouseup:t.mouseUp}})]),t.footer?n("div",{staticClass:"zm-sign-handle"},[n("button",{staticClass:"zm-buttom zm-button--mini",on:{click:t.handleClear}},[t._v(" 清空 ")]),n("button",{staticClass:"zm-buttom zm-button--mini",on:{click:t.handleDone}},[t._v(" 完成 ")])]):t._e()])},h=[],f={name:"ZmSign",props:{color:{type:String,default:"#000"},canvasWidth:Number,canvasHeight:Number,lineWidth:{type:Number,default:3},bgColor:{type:String,default:"#f7f7f7"},imgBgColor:{type:String,default:"transparent"},crop:{type:Boolean,default:!0},footer:{type:Boolean,default:!0},beforeDone:Function},data(){return{ImgSrc:"",points:[],canvas2d:null,w:"",h:"",startX:0,startY:0,endY:0,endX:0,isDraw:!1,hasDrew:!1,isVertical:!1}},watch:{canvasWidth(t){this.w=t},canvasHeight(t){this.h=t}},mounted(){let t=this.$refs.canvasF;t.style.background=this.bgColor,this.canvas2d=t.getContext("2d"),this.canvas2d.strokeStyle=this.color,this.canvas2d.lineWidth=this.lineWidth,this.resizeRender(!0),document.onmouseup=()=>{this.isDraw=!1};var e="onorientationchange"in window?"orientationchange":"resize";window.addEventListener(e,this.resizeRender,!1)},beforeDestoryed(){var t="onorientationchange"in window?"orientationchange":"resize";window.removeEventListener(t,this.resizeRender,!1)},methods:{resizeRender(t){const e=window.orientation,n=0==e||180==e;this.isVertical=n,setTimeout(()=>{const t=window.innerWidth,e=window.innerHeight;n?this.verticalCanvas(t,e):this.horizontalCanvas(t,e)},50),!0!==t&&this.$emit("orientationchange",e)},verticalCanvas(t,e){this.w=t-40,this.h=e/2},horizontalCanvas(t,e){this.w=t-40,this.h=e-90},mouseDown(t){t=t||event,t.cancelable&&t.preventDefault();let e={x:t.offsetX,y:t.offsetY};this.drawStart(e),this.isDraw=!0},touchStart(t){if(t=t||event,t.cancelable&&t.preventDefault(),1==t.touches.length){const e=t.targetTouches[0];this.isDraw=!0;let n={x:e.clientX-e.target.offsetLeft,y:e.clientY-e.target.offsetTop};this.drawStart(n)}},mouseMove(t){if(t=t||event,t.cancelable&&t.preventDefault(),this.isDraw){let e={x:t.offsetX,y:t.offsetY};this.drawMove(e)}},touchMove(t){if(t=t||event,t.cancelable&&t.preventDefault(),1==t.touches.length){const e=t.targetTouches[0];let n={x:e.clientX-e.target.offsetLeft,y:e.clientY-e.target.offsetTop};this.drawMove(n)}},mouseUp(t){t=t||event,t.cancelable&&t.preventDefault();let e={x:t.offsetX,y:t.offsetY};this.drawEnd(e),this.isDraw=!1},touchEnd(t){if(t=t||event,t.cancelable&&t.preventDefault(),1==t.touches.length){const e=t.targetTouches[0];let n={x:e.clientX-e.target.offsetLeft,y:e.clientY-e.target.offsetTop};this.drawEnd(n)}},drawStart(t){this.hasDrew=!0,this.startX=t.x,this.startY=t.y;const{canvas2d:e}=this;e.beginPath(),e.moveTo(this.startX,this.startY),e.lineTo(t.x,t.y),e.lineCap="round",e.lineJoin="round",e.lineWidth=this.lineWidth,e.stroke(),e.closePath(),this.points.push(t)},drawMove(t){const{canvas2d:e}=this;e.beginPath(),e.moveTo(this.startX,this.startY),e.lineTo(t.x,t.y),e.strokeStyle=this.lineColor,e.lineWidth=this.lineWidth,e.lineCap="round",e.lineJoin="round",e.stroke(),e.closePath(),this.startY=t.y,this.startX=t.x,this.points.push(t)},drawEnd(t){const{canvas2d:e}=this;e.beginPath(),e.moveTo(this.startX,this.startY),e.lineTo(t.x,t.y),e.lineCap="round",e.lineJoin="round",e.stroke(),e.closePath(),this.points.push(t),this.points.push({x:-1,y:-1})},createImage(){const t=new Promise((t,e)=>{if(!this.hasDrew)return void e("Warning: Not Signned!");const n=this.$refs.canvasF,{canvas2d:i}=this,r=i.getImageData(0,0,n.width,n.height);i.globalCompositeOperation="destination-over",i.fillStyle=this.bgColor,i.fillRect(0,0,n.width,n.height);let o=n.toDataURL();if(i.clearRect(0,0,n.width,n.height),i.putImageData(r,0,0),i.globalCompositeOperation="source-over",this.crop){const t=this.getCropArea(r.data);var s=document.createElement("canvas");const e=s.getContext("2d");s.width=t[2]-t[0],s.height=t[3]-t[1];const n=i.getImageData(...t);e.globalCompositeOperation="destination-over",e.putImageData(n,0,0),e.fillStyle=this.imgBgColor,e.fillRect(0,0,s.width,s.height),o=s.toDataURL(),s=null}t(o)});return t},getCropArea(t){const e=this.$refs.canvasF;for(var n=e.width,i=0,r=e.height,o=0,s=0;s<e.width;s++)for(var a=0;a<e.height;a++){var c=4*(s+e.width*a);(t[c]>0||t[c+1]>0||t[c+2]||t[c+3]>0)&&(o=Math.max(a,o),i=Math.max(s,i),r=Math.min(a,r),n=Math.min(s,n))}n++,i++,r++,o++;const l=[n,r,i,o];return l},handleClear(){this.clear(),this.$emit("on-clear")},handleDone(){let t=this.$refs["canvasF"];const{beforeDone:e}=this;let n=!0;e&&"function"===typeof e&&(n=e(t)),n&&(this.createImage().then(t=>{this.ImgSrc=t}),this.$emit("on-done",this.ImgSrc))},clear(){this.hasDrew=!1;const{canvas2d:t}=this;t.clearRect(0,0,this.$refs.canvasF.width,this.$refs.canvasF.height),this.points=[],this.ImgSrc="",this.isDraw=!1},async done(){let t=await this.createImage();return t}}},p=f;n("f6d3");function v(t,e,n,i,r,o,s,a){var c,l="function"===typeof t?t.options:t;if(e&&(l.render=e,l.staticRenderFns=n,l._compiled=!0),i&&(l.functional=!0),o&&(l._scopeId="data-v-"+o),s?(c=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),r&&r.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},l._ssrRegister=c):r&&(c=a?function(){r.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:r),c)if(l.functional){l._injectStyles=c;var u=l.render;l.render=function(t,e){return c.call(e),u(t,e)}}else{var d=l.beforeCreate;l.beforeCreate=d?[].concat(d,c):[c]}return{exports:t,options:l}}var g=v(p,d,h,!1,null,null,null),m=g.exports;m.install=function(t){t.component(m.name,m)};var b=m;n("b20f");const w=[b],y=function(t){w.forEach(e=>{t.component(e.name,e)}),t.use(u)};"undefined"!==typeof window&&window.Vue&&y(window.Vue);var x={install:y,ZmSign:b};e["default"]=x}})}));
//# sourceMappingURL=zm-sign.umd.min.js.map